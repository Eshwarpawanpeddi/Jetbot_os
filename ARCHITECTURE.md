# AI Pet Robot - System Architecture & Data Flow Documentation

## 1. System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         NETWORK LAYER (WiFi/Ethernet)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                          â”‚                          â”‚
         â”‚                          â”‚                          â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚JETSON NANOâ”‚         â”‚  LAPTOP SERVER  â”‚         â”‚  MOBILE APP â”‚
    â”‚   2GB     â”‚         â”‚   (Python)      â”‚         â”‚(React Native)â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚                        â”‚                         â”‚
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â”‚   USB CAM  â”‚          â”‚ Flask App   â”‚           â”‚ WebSocket   â”‚
    â”‚   HDMI OUT â”‚          â”‚ SocketIO    â”‚           â”‚  Client     â”‚
    â”‚   640x480  â”‚          â”‚ OpenCV      â”‚           â”‚ Voice Input â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â”‚ Face Engine â”‚           â”‚ Display App â”‚
          â”‚                 â”‚ AI/LLM      â”‚           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚ Bluetooth   â”‚                  â”‚
    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
    â”‚     TCP SOCKET         â”‚  WEBSOCKET (ws://)â”‚            â”‚
    â”‚     (video stream)     â”‚  (real-time cmds) â”‚            â”‚
    â”‚     Port 5001          â”‚  Port 5000        â”‚            â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜            â”‚
          â”‚                                 â”‚                 â”‚
          â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚              â”‚
          â”‚              â”‚
    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚   BLUETOOTH (Classic)      â”‚
    â”‚   Serial RFCOMM (/dev/    â”‚
    â”‚   rfcomm0)                â”‚
    â”‚   115200 Baud             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
            â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
            â”‚   ESP32    â”‚
            â”‚  DevKit    â”‚
            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         â”‚         â”‚
    â”Œâ”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”
    â”‚Motorsâ”‚  â”‚Audio â”‚  â”‚LEDs   â”‚
    â”‚(2x)  â”‚  â”‚(PWM) â”‚  â”‚(RGB)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. Data Flow Diagram

### Camera â†’ Server â†’ Display Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ JETSON NANO (Capture Pipeline)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  USB Camera (30 FPS)                                            â”‚
â”‚       â”‚                                                         â”‚
â”‚       â–¼                                                         â”‚
â”‚  cv2.VideoCapture()                                            â”‚
â”‚  - 640x480 resolution                                          â”‚
â”‚  - 30 FPS frame rate                                           â”‚
â”‚       â”‚                                                         â”‚
â”‚       â–¼                                                         â”‚
â”‚  Frame Buffer (deque, max 10)                                  â”‚
â”‚       â”‚                                                         â”‚
â”‚       â–¼                                                         â”‚
â”‚  JPEG Compression (80% quality)                                â”‚
â”‚       â”‚                                                         â”‚
â”‚       â–¼                                                         â”‚
â”‚  TCP Socket Transmission                                       â”‚
â”‚  Format: FRAME_START + JPEG_DATA + FRAME_END                  â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ ~8 Mbps (30 FPS @ 640x480 80% JPEG)
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAPTOP SERVER (Processing Pipeline)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Frame Receiver (TCP Socket)                                   â”‚
â”‚       â”‚                                                        â”‚
â”‚       â–¼                                                        â”‚
â”‚  AI/LLM Processing (Optional)                                 â”‚
â”‚  - Object detection                                           â”‚
â”‚  - Scene understanding                                        â”‚
â”‚  - Emotion analysis                                           â”‚
â”‚       â”‚                                                        â”‚
â”‚       â–¼                                                        â”‚
â”‚  Determine Display Mode                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ Current Mode â”‚ Action               â”‚                      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
â”‚  â”‚ face         â”‚ Generate face with   â”‚                      â”‚
â”‚  â”‚              â”‚ current emotion      â”‚                      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
â”‚  â”‚ text         â”‚ Render text content  â”‚                      â”‚
â”‚  â”‚              â”‚ (shopping list, etc.)â”‚                      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
â”‚  â”‚ hybrid       â”‚ Show face, switch    â”‚                      â”‚
â”‚  â”‚              â”‚ to text on request   â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚       â”‚                                                        â”‚
â”‚       â–¼                                                        â”‚
â”‚  Face Animation Engine                                        â”‚
â”‚  - OpenCV drawing operations                                  â”‚
â”‚  - Emotion-based features                                     â”‚
â”‚  - Blinking animation (3s interval)                           â”‚
â”‚       â”‚                                                        â”‚
â”‚       â–¼                                                        â”‚
â”‚  Frame Broadcast (30 FPS)                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ HDMI Display          â”‚ Mobile App       â”‚                â”‚
â”‚  â”‚ (via Jetson Nano)     â”‚ (WebSocket)      â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Voice Command Processing Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MOBILE APP (Voice Recording)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚  User clicks: ğŸ¤ Voice Command         â”‚
â”‚       â”‚                                â”‚
â”‚       â–¼                                â”‚
â”‚  Audio Recording (5 seconds)           â”‚
â”‚  - Sample Rate: 44.1kHz               â”‚
â”‚  - Channels: 1 (mono)                 â”‚
â”‚       â”‚                                â”‚
â”‚       â–¼                                â”‚
â”‚  Audio Buffer                          â”‚
â”‚       â”‚                                â”‚
â”‚       â–¼                                â”‚
â”‚  WebSocket Emit: 'voice_command'       â”‚
â”‚  Data: { text: transcribed_speech }    â”‚
â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ WebSocket (UTF-8 JSON)
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LAPTOP SERVER (Processing)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚  Receive: 'voice_command'              â”‚
â”‚       â”‚                                â”‚
â”‚       â–¼                                â”‚
â”‚  Speech-to-Text Conversion             â”‚
â”‚  (Google Cloud Speech-to-Text)         â”‚
â”‚       â”‚                                â”‚
â”‚       â–¼                                â”‚
â”‚  NLP Processing                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Input: "move forward"            â”‚ â”‚
â”‚  â”‚ Output: Command = "move_forward" â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚       â”‚                                â”‚
â”‚       â–¼                                â”‚
â”‚  AI Response Generation                â”‚
â”‚  - Determine action                   â”‚
â”‚  - Select emotion                     â”‚
â”‚  - Generate display content           â”‚
â”‚       â”‚                                â”‚
â”‚       â–¼                                â”‚
â”‚  Execute Action                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Command      â”‚ Action            â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ move_forward â”‚ Motor(80, 80)     â”‚ â”‚
â”‚  â”‚ move_backwardâ”‚ Motor(-80, -80)   â”‚ â”‚
â”‚  â”‚ turn_left    â”‚ Motor(-50, 80)    â”‚ â”‚
â”‚  â”‚ turn_right   â”‚ Motor(80, -50)    â”‚ â”‚
â”‚  â”‚ stop         â”‚ Motor(0, 0)       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚       â”‚                                â”‚
â”‚       â–¼                                â”‚
â”‚  Send Bluetooth Command to ESP32       â”‚
â”‚       â”‚                                â”‚
â”‚       â–¼                                â”‚
â”‚  Broadcast Status to Clients           â”‚
â”‚  (Mobile App, Jetson Nano)             â”‚
â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Bluetooth Serial
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ESP32 (Motor Control)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚  Receive Bluetooth Command             â”‚
â”‚  Format: [0x01][L_SPEED][R_SPEED]     â”‚
â”‚       â”‚                                â”‚
â”‚       â–¼                                â”‚
â”‚  Parse Motor Speeds                    â”‚
â”‚       â”‚                                â”‚
â”‚       â–¼                                â”‚
â”‚  PWM Generation                        â”‚
â”‚  - Left Motor: GPIO 15                â”‚
â”‚  - Right Motor: GPIO 23               â”‚
â”‚       â”‚                                â”‚
â”‚       â–¼                                â”‚
â”‚  Physical Motor Movement               â”‚
â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3. Motor Control Protocol

### Bluetooth Packet Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MOTOR CONTROL PACKET                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚ Byte 0: Command Type                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ 0x01 = Motor Control                   â”‚â”‚
â”‚ â”‚ 0x02 = Audio Command                   â”‚â”‚
â”‚ â”‚ 0x03 = LED Control                     â”‚â”‚
â”‚ â”‚ 0xFF = Heartbeat                       â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                             â”‚
â”‚ Byte 1: Left Motor Speed                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ Range: 0-200                            â”‚â”‚
â”‚ â”‚ Conversion: speed = (byte * 2) - 100   â”‚â”‚
â”‚ â”‚ 0 = -100 (full reverse)                â”‚â”‚
â”‚ â”‚ 100 = 0 (stop)                         â”‚â”‚
â”‚ â”‚ 200 = 100 (full forward)               â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                             â”‚
â”‚ Byte 2: Right Motor Speed                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ Same as Left Motor Speed                â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                             â”‚
â”‚ Byte 3: Checksum                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ (0x01 + Left + Right) & 0xFF            â”‚â”‚
â”‚ â”‚ Used for error detection                â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Example: Move Forward at 80% Speed
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Byte 0: 0x01 (Motor Control)            â”‚
â”‚ Byte 1: 190 = (80 + 100) / 2            â”‚
â”‚ Byte 2: 190 = (80 + 100) / 2            â”‚
â”‚ Byte 3: (0x01 + 190 + 190) & 0xFF = 125â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 4. WebSocket Event Flow

### Client â†’ Server Events

```
Mobile App â†’ Server Events:

1. voice_command
   {
     "text": "move forward",
     "timestamp": 1234567890
   }

2. manual_control
   {
     "left_speed": 80,      // -100 to 100
     "right_speed": 80,     // -100 to 100
     "duration": 5000       // milliseconds (optional)
   }

3. emotion_request
   {
     "emotion": "happy"     // happy, sad, excited, neutral, confused
   }

4. display_request
   {
     "type": "text",        // face, text, hybrid
     "title": "Shopping List",
     "content": "1. Milk\n2. Bread\n3. Eggs"
   }

5. mode_switch
   {
     "mode": "manual"       // automatic, manual
   }
```

### Server â†’ Client Events

```
Server â†’ Client Events:

1. display_frame
   {
     "frame": "base64_encoded_jpeg_image",
     "emotion": "happy",
     "timestamp": 1234567890
   }

2. command_processed
   {
     "action": "move_forward",
     "emotion": "excited",
     "display_content": {
       "type": "face"
     },
     "status": "success"
   }

3. emotion_update
   {
     "emotion": "happy",
     "timestamp": 1234567890
   }

4. status_update
   {
     "mode": "manual",
     "connected_devices": {
       "jetson": true,
       "esp32": true,
       "mobile_app": true
     },
     "timestamp": 1234567890
   }

5. error
   {
     "error_code": 500,
     "message": "Motor control failed",
     "timestamp": 1234567890
   }
```

## 5. Display Rendering Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Display Generation (30 FPS Loop)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚ Check Display Mode                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ if mode == "face":                       â”‚â”‚
â”‚ â”‚   - Generate cute robot face             â”‚â”‚
â”‚ â”‚   - Apply emotion features               â”‚â”‚
â”‚ â”‚   - Handle blinking animation            â”‚â”‚
â”‚ â”‚                                          â”‚â”‚
â”‚ â”‚ elif mode == "text":                     â”‚â”‚
â”‚ â”‚   - Render title                         â”‚â”‚
â”‚ â”‚   - Wrap text content                    â”‚â”‚
â”‚ â”‚   - Apply background color               â”‚â”‚
â”‚ â”‚                                          â”‚â”‚
â”‚ â”‚ else (hybrid):                           â”‚â”‚
â”‚ â”‚   - Check request_queue                  â”‚â”‚
â”‚ â”‚   - If text requested: show text         â”‚â”‚
â”‚ â”‚   - Else: show face                      â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚       â”‚                                     â”‚
â”‚       â–¼                                     â”‚
â”‚ Face Features (if face mode)                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ Happy:    smile + wide eyes              â”‚â”‚
â”‚ â”‚ Sad:      frown + droopy eyes            â”‚â”‚
â”‚ â”‚ Excited:  big smile + wide eyes          â”‚â”‚
â”‚ â”‚ Neutral:  straight mouth + normal eyes   â”‚â”‚
â”‚ â”‚ Confused: question mark mouth            â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚       â”‚                                     â”‚
â”‚       â–¼                                     â”‚
â”‚ JPEG Compression (80% quality)              â”‚
â”‚       â”‚                                     â”‚
â”‚       â–¼                                     â”‚
â”‚ Broadcast (600 KB @ 30 FPS = 18 Mbps)      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ Jetson Nano (via TCP)                   â”‚â”‚
â”‚ â”‚ Mobile App (via WebSocket)               â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚       â”‚                                     â”‚
â”‚       â–¼                                     â”‚
â”‚ Sleep: (1000 / 30) ms = 33.3 ms            â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 6. State Management

```
Robot State:
{
  mode: "automatic" | "manual",
  emotion: "happy" | "sad" | "excited" | "neutral" | "confused",
  is_blinking: boolean,
  current_display_mode: "face" | "text" | "hybrid",
  display_content: {
    type: string,
    emotion?: string,
    title?: string,
    content?: string
  },
  voice_input_active: boolean,
  motor_state: {
    left: -100 to 100,
    right: -100 to 100,
    speed: 0 to 100
  },
  audio_playing: boolean,
  connected_devices: {
    jetson: boolean,
    esp32: boolean,
    mobile_app: boolean
  },
  frame_buffer: deque<Frame>,
  last_frame_time: timestamp
}
```

## 7. Timing Diagrams

### Motor Response Timing

```
Timeline (milliseconds):

0ms    â”Œâ”€ Voice captured
       â”‚
50ms   â”œâ”€ Speech-to-text processing starts
       â”‚
250ms  â”œâ”€ NLP processing complete
       â”‚
280ms  â”œâ”€ Command sent to ESP32 via Bluetooth
       â”‚
300ms  â”œâ”€ Bluetooth packet received on ESP32
       â”‚
310ms  â”œâ”€ Motor PWM updated
       â”‚
350ms  â”œâ”€ Motor physically moves (mechanical delay)
       â”‚
500ms  â””â”€ Robot reaches steady state

Total Latency: ~500ms
Breakdown:
- Audio processing: 50ms
- Speech-to-text: 200ms
- NLP: 30ms
- Network: 20ms
- ESP32 processing: 10ms
- Motor mechanical: 40ms
```

### Display Update Timing

```
Timeline (per frame at 30 FPS):

0ms    â”Œâ”€ Frame 0 generated
       â”‚
33ms   â”œâ”€ Frame 0 encoded (JPEG)
       â”‚
50ms   â”œâ”€ Frame 0 transmitted
       â”‚
70ms   â”œâ”€ Frame 1 generated
       â”‚
103ms  â”œâ”€ Frame 1 encoded
       â”‚
120ms  â”œâ”€ Frame 1 transmitted
       â”‚
       â””â”€ Frame display latency: ~50ms

Frame Buffer:
[Frame N-2] [Frame N-1] [Frame N] [Frame N+1]
(oldest)                          (newest)
```

---

**Version**: 1.0.0  
**Last Updated**: December 7, 2024